<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="org.n52.series.db.beans">
    <class name="DatasetEntity" table="dataset">
        <id name="id" type="long">
            <column name="id">
                <comment>Table primary key, used for relations</comment>
            </column>
            <generator class="native">
                <param name="sequence_name">dataset_seq</param>
            </generator>
        </id>
        <discriminator column="value_type" force="true" type="string" not-null="false"/>

        <many-to-one class="ProcedureEntity" column="`procedure`" name="procedure" not-null="true" unique-key="dataset_identity"
        	foreign-key="dataset_procedure_fk" />
        <many-to-one class="PhenomenonEntity" column="phenomenon" name="phenomenon" not-null="true" unique-key="dataset_identity"
        	foreign-key="dataset_phenomenon_fk" />
        <many-to-one class="org.n52.series.db.beans.OfferingEntity" column="offering" name="offering" not-null="true" unique-key="dataset_identity"
           foreign-key="dataset_offering_fk" />
        <many-to-one class="CategoryEntity" column="category" name="category" not-null="false" unique-key="dataset_identity"
        	foreign-key="dataset_category_fk"  />
        <many-to-one class="FeatureEntity" column="feature" name="feature" not-null="false" unique-key="dataset_identity"
            foreign-key="dataset_feature_fk" />

        <many-to-one name="observationType" class="ObservationTypeEntity" not-null="false" foreign-key="dataset_observation_type_fk">
            <column name="observation_type">
                <comment>Foreign Key (FK) to the related observation type. Contains "observationtype".observationtypeid</comment>
            </column>
        </many-to-one>

        <property column="first_time_stamp" name="firstValueAt" type="timestamp" />
        <property column="last_time_stamp" name="lastValueAt" type="timestamp" />

        <property column="first_value" name="firstValue" type="double" precision="29" />
        <property column="last_value" name="lastValue" type="double" precision="29" />

        <many-to-one class="DataEntity" column="first_observation" name="firstObservation" fetch="select" foreign-key="dataset_first_obs_fk"/>
        <many-to-one class="DataEntity" column="last_observation" name="lastObservation" fetch="select" foreign-key="dataset_last_obs_fk"/>

        <property name="deleted" type="numeric_boolean">
            <column name="deleted" not-null="true" default="0" check="deleted in (1,0)">
                <comment>Flag to indicate that this dataset is deleted or not. Set if the related procedure is deleted
                    via DeleteSensor operation (OGC SWES 2.0 - DeleteSensor operation)</comment>
            </column>
        </property>

        <property name="disabled" type="numeric_boolean">
            <column name="disabled" not-null="true" default="0" check="disabled in (1,0)">
                <comment>Flag to indicate that this dataset is disabled for SOS transactional insertion or not.</comment>
            </column>
        </property>

        <property name="published" type="numeric_boolean">
            <column name="published" not-null="true" default="1" check="published in (1,0)">
                <comment>Flag to indicate that this dataset is published or not. A not published dataset is not contained
                    in GetObservation and GetDataAvailability responses</comment>
            </column>
        </property>

        <property name="hiddenChild" type="numeric_boolean">
            <column name="hidden_child" not-null="true" default="0" check="hidden_child in (1,0)">
            </column>
        </property>

        <property column="decimals" name="decimals" not-null="false" type="integer" />

        <property name="domainId" type="string">
            <column name="domain_id" not-null="false" unique-key="dataset_id_uk">
                <comment>The identifier of the dataset, gml:identifier. Unique</comment>
            </column>
        </property>

        <many-to-one name="codespace" class="CodespaceEntity" foreign-key="dataset_codespace_fk">
            <column name="codespace">
                <comment>Relation/foreign key to the codespace table. Contains the
                    gml:identifier codespace. Optional</comment>
            </column>
        </many-to-one><property name="name" type="string">
            <column name="name">
                <comment>The name of the dataset, gml:name. Optional</comment>
            </column>
        </property><many-to-one name="codespaceName" class="CodespaceEntity" foreign-key="dataset_codespace_name_fk">
            <column name="codespace_mame">
                <comment>Relation/foreign key to the codespace table. Contains the
                    gml:name codespace. Optional</comment>
            </column>
        </many-to-one>

        <property name="description" type="string">
            <column name="description">
                <comment>Description of the dataset, gml:description. Optional</comment>
            </column>
        </property>

        <set inverse="false" name="parameters" table="dataset_parameter" cascade="delete-orphan">
            <key column="dataset" not-null="true" foreign-key="dataset_parameter_fk" />
            <many-to-many class="org.n52.series.db.beans.parameter.Parameter" column="parameter"
                foreign-key="parameter_dataset_fk" />
        </set>

        <subclass discriminator-value="quantity" name="QuantityDatasetEntity">
            <property formula="3" name="numberOfDecimals" type="int" />
            <many-to-one class="UnitEntity" column="unit" name="unit" foreign-key="dataset_unit_fk" />
        </subclass>
        <subclass discriminator-value="text" name="TextDatasetEntity"/>
        <subclass discriminator-value="count" name="CountDatasetEntity"/>
        <subclass discriminator-value="blob" name="BlobDatasetEntity"/>
        <subclass discriminator-value="boolean" name="BooleanDatasetEntity" />
        <subclass discriminator-value="category" name="CategoryDatasetEntity">
            <many-to-one class="UnitEntity" column="unit" name="unit" foreign-key="dataset_unit_fk" />
        </subclass>
        <subclass discriminator-value="geometry" name="GeometryDatasetEntity"/>
        <subclass discriminator-value="swedataarray" name="SweDataArrayDatasetEntity"/>
        <subclass discriminator-value="complex" name="ComplexDatasetEntity"/>
        <subclass discriminator-value="quantity-profile" name="ProfileDatasetEntity">
            <many-to-one class="UnitEntity" column="unit" name="unit" foreign-key="dataset_unit_fk" />
            <property name="verticalParameterName" formula="'depth'" type="string" />
        </subclass>
    </class>
</hibernate-mapping>
