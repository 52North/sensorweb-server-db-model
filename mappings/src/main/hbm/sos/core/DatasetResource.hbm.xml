<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="org.n52.series.db.beans">
    <class name="DatasetEntity" table="dataset">
        <id name="pkid" type="long">
            <column name="pkid">
                <comment>Table primary key, used for relations</comment>
            </column>
            <generator class="native">
                <param name="sequence">dataset_seq</param>
            </generator>
        </id>
        <discriminator column="valueType" force="true" type="string" />

        <many-to-one class="ObservationConstellationEntity" column="observationconstellation" name="observationConstellation"
            foreign-key="datasetobsconstfk" unique-key="datasetIdentity" />
        <many-to-one class="FeatureEntity" column="feature" name="feature" unique-key="datasetIdentity"
            foreign-key="datasetfeaturefk" />
        <many-to-one class="CategoryEntity" column="category" name="category" foreign-key="datasetcategoryfk"
            unique-key="datasetIdentity" />
        <many-to-one class="PlatformEntity" column="procedure" name="platform" insert="false" update="false"
            foreign-key="datasetplatformfk" />
        <many-to-one name="codespace" class="CodespaceEntity" foreign-key="datasetCodespaceEntityIdentifierFk">
            <column name="codespace">
                <comment>Relation/foreign key to the codespace table. Contains the
                    gml:identifier codespace. Optional</comment>
            </column>
        </many-to-one>
        <many-to-one name="codespaceName" class="CodespaceEntity" foreign-key="datasetCodespaceEntityNameFk">
            <column name="codespaceName">
                <comment>Relation/foreign key to the codespace table. Contains the
                    gml:name codespace. Optional</comment>
            </column>
        </many-to-one>

        <property column="valueType" name="valueType" type="string" insert="false" update="false" />
        <property column="firsttimestamp" name="firstValueAt" type="timestamp" />
        <property column="lasttimestamp" name="lastValueAt" type="timestamp" />

        <property name="deleted" type="org.hibernate.type.TrueFalseType">
            <column name="deleted" not-null="true" default="'F'" check="deleted in ('T','F')">
                <comment>Flag to indicate that this series is deleted or not. Set if the related procedure is deleted
                    via DeleteSensor operation (OGC SWES 2.0 - DeleteSensor operation)</comment>
            </column>
        </property>

        <property name="published" type="org.hibernate.type.TrueFalseType">
            <column name="published" not-null="true" default="'T'" check="published in ('T','F')">
                <comment>Flag to indicate that this series is published or not. A not published series is not contained
                    in GetObservation and GetDataAvailability responses</comment>
            </column>
        </property>

        <property name="hiddenChild" type="org.hibernate.type.TrueFalseType">
            <column name="hiddenChild" not-null="true" default="'F'" check="hiddenChild in ('T','F')">
            </column>
        </property>

        <property name="domainId" type="string">
            <column name="domainId" not-null="false" unique-key="datasetIdentifierUK">
                <comment>The identifier of the dataset, gml:identifier. Unique</comment>
            </column>
        </property>

        <property name="name" type="string">
            <column name="name">
                <comment>The name of the dataset, gml:name. Optional</comment>
            </column>
        </property>

        <property name="description" type="string">
            <column name="description">
                <comment>Description of the dataset, gml:description. Optional</comment>
            </column>
        </property>

        <!-- Possible performance issue!!! -->
        <set inverse="true" name="resultTimes" table="observation">
            <key column="dataset" foreign-key="datasetresulttimefk" />
            <element column="resulttime" type="string" />
        </set>

        <set inverse="false" name="parameters" table="datasetparameter" cascade="delete-orphan">
            <key column="dataset" not-null="true" foreign-key="datasetparamdatasetfk" />
            <many-to-many class="org.n52.series.db.beans.parameter.Parameter" column="parameter"
                foreign-key="datasetparamparamfk" />
        </set>
        
        <bag fetch="select" name="observations" table="datasetobservation" >
            <key column="dataset" not-null="true" foreign-key="datasetfk"/>
            <many-to-many column="data" class="DataEntity" />
        </bag>
        
        <subclass discriminator-value="quantity" name="QuantityDatasetEntity">
            <property formula="3" name="numberOfDecimals" type="int" />
            <many-to-one class="UnitEntity" column="unit" name="unit" foreign-key="datasetunitfk" />
        </subclass>

        <subclass discriminator-value="text" name="TextDatasetEntity">
        </subclass>

        <subclass discriminator-value="count" name="CountDatasetEntity">
        </subclass>

        <subclass discriminator-value="blob" name="BlobDatasetEntity">
        </subclass>

        <subclass discriminator-value="boolean" name="BooleanDatasetEntity">
        </subclass>

        <subclass discriminator-value="category" name="CategoryDatasetEntity">
            <many-to-one class="UnitEntity" column="unit" name="unit" foreign-key="datasetunitfk" />
        </subclass>

        <subclass discriminator-value="complex" name="ComplexDatasetEntity">
        </subclass>

        <subclass discriminator-value="geometry" name="GeometryDatasetEntity">
        </subclass>

        <subclass discriminator-value="swedataarray" name="SweDataArrayDatasetEntity">
        </subclass>

        <subclass discriminator-value="quantity-profile" name="ProfileDatasetEntity">
            <many-to-one class="UnitEntity" column="unit" insert="false" name="unit" update="false" />
            <property name="verticalParameterName" formula="'depth'" type="string" />
        </subclass>
    </class>
</hibernate-mapping>
